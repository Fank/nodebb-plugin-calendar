{"version":3,"sources":["../../src/lib/init.js"],"names":["shallowEqual","a","b","Object","keys","every","key","callback","router","middleware","defaults","checkingInterval","mainPostOnly","respondIfCanReply","old","settings","changed","asCallback"],"mappings":";;;;;;;;;;;;AAAA;;;;AACA;;AACA;;;;AAEA,MAAMA,eAAe,CAACC,CAAD,EAAIC,CAAJ,KAAUC,OAAOC,IAAP,CAAYH,CAAZ,EAAeI,KAAf,CAAqBC,OAAOL,EAAEK,GAAF,MAAWJ,EAAEI,GAAF,CAAvC,CAA/B;;kBAEe,OAAyBC,QAAzB,KAAsC;AAAA,MAAnCC,MAAmC,QAAnCA,MAAmC;AAAA,MAA3BC,UAA2B,QAA3BA,UAA2B;;AACnD,6BAAYD,MAAZ,EAAoBC,UAApB;;AAEA,QAAMC,WAAW;AACfC,sBAAkB,OAAO,EAAP,GAAY,CADf;AAEfC,kBAAc,KAFC;AAGfC,uBAAmB;AAHJ,GAAjB;AAKA,2BAAC,aAAY;AACX,UAAMC,MAAM,MAAM,4BAAlB;AACA,UAAMC,sCAAgBL,QAAhB,EAA6BI,GAA7B,CAAN;;AAEA,UAAME,UAAU,CAAChB,aAAae,QAAb,EAAuBD,GAAvB,CAAjB;AACA,QAAIE,OAAJ,EAAa;AACX,YAAM,2BAAYD,QAAZ,CAAN;AACD;;AAED,UAAM,oCAAN;AACD,GAVD,IAUKE,UAVL,CAUgBV,QAVhB;AAWD,C","file":"init.js","sourcesContent":["import controllers from './controllers';\nimport { initNotifierDaemon } from './reminders';\nimport { getSettings, setSettings } from './settings';\n\nconst shallowEqual = (a, b) => Object.keys(a).every(key => a[key] === b[key]);\n\nexport default ({ router, middleware }, callback) => {\n  controllers(router, middleware);\n\n  const defaults = {\n    checkingInterval: 1000 * 60 * 5,\n    mainPostOnly: false,\n    respondIfCanReply: false,\n  };\n  (async () => {\n    const old = await getSettings();\n    const settings = { ...defaults, ...old };\n\n    const changed = !shallowEqual(settings, old);\n    if (changed) {\n      await setSettings(settings);\n    }\n\n    await initNotifierDaemon();\n  })().asCallback(callback);\n};\n"]}