{"version":3,"sources":["../../src/lib/privileges.js"],"names":["p","promisify","privileges","require","main","posts","privilegesPostCan","can","privilegesTopicCan","topics","filterUidsByCid","categories","filterUids","filterPids","filter","privilegeNames","canPost","canViewPost","pid","uid","canPostEvent","tid","getCidByPid","canRespond","then","respondIfCanReply","filterUidsByPid","uids","cid","filterByPid","events","map","e","filtered","includes","privilegesList","list","callback","privilegesGroupsList","privilegesListHuman","name"],"mappings":";;;;;;;;;;;AAAA;;;;AACA;;;;AAEA,MAAMA,IAAI,mBAAQC,SAAlB;;AAEA,MAAMC,aAAaC,QAAQC,IAAR,CAAaD,OAAb,CAAqB,kBAArB,CAAnB;AACA,MAAME,QAAQF,QAAQC,IAAR,CAAaD,OAAb,CAAqB,aAArB,CAAd;AACA,MAAMG,oBAAoBN,EAAEE,WAAWG,KAAX,CAAiBE,GAAnB,CAA1B;AACA,MAAMC,qBAAqBR,EAAEE,WAAWO,MAAX,CAAkBF,GAApB,CAA3B;AACA,MAAMG,kBAAkBV,EAAEE,WAAWS,UAAX,CAAsBC,UAAxB,CAAxB;AACA,MAAMC,aAAab,EAAEE,WAAWG,KAAX,CAAiBS,MAAnB,CAAnB;;AAEA,MAAMC,iBAAiB;AACrBC,WAAS;AADY,CAAvB;;AAIA,MAAMC,cAAc,CAACC,GAAD,EAAMC,GAAN,KAAcb,kBAAkB,MAAlB,EAA0BY,GAA1B,EAA+BC,GAA/B,CAAlC;AACA,MAAMC,eAAe,CAACC,GAAD,EAAMF,GAAN,KAAcX,mBAAmBO,eAAeC,OAAlC,EAA2CK,GAA3C,EAAgDF,GAAhD,CAAnC;AACA,MAAMG,cAActB,EAAEK,MAAMiB,WAAR,CAApB;;AAEA,MAAMC,aAAa,CAACL,GAAD,EAAMC,GAAN,KACjB,0BAAW,mBAAX,EACGK,IADH,CACSC,iBAAD,IAAuB;AAC3B,MAAIA,iBAAJ,EAAuB;AACrB,WAAOnB,kBAAkB,OAAlB,EAA2BY,GAA3B,EAAgCC,GAAhC,CAAP;AACD;AACD,SAAOF,YAAYC,GAAZ,EAAiBC,GAAjB,CAAP;AACD,CANH,CADF;;AASA,MAAMO,kBAAkB,CAACC,IAAD,EAAOT,GAAP,KACtBI,YAAYJ,GAAZ,EACCM,IADD,CACMI,OAAOlB,gBAAgB,MAAhB,EAAwBkB,GAAxB,EAA6BD,IAA7B,CADb,CADF;;AAIA,MAAME,cAAc,CAACC,MAAD,EAASX,GAAT,KAClBN,WAAW,MAAX,EAAmBiB,OAAOC,GAAP,CAAWC,KAAKA,EAAEd,GAAlB,CAAnB,EAA2CC,GAA3C,EACCK,IADD,CACMS,YAAYH,OAAOhB,MAAP,CAAckB,KAAKC,SAASC,QAAT,CAAkBF,EAAEd,GAApB,CAAnB,CADlB,CADF;;AAIA,MAAMiB,iBAAiB,CAACC,IAAD,EAAOC,QAAP,KACrBA,SAAS,IAAT,6CAAmBD,IAAnB,IAAyBrB,eAAeC,OAAxC,GADF;AAEA,MAAMsB,uBAAuB,CAACF,IAAD,EAAOC,QAAP,KAC3BA,SAAS,IAAT,6CAAmBD,IAAnB,IAA0B,UAASrB,eAAeC,OAAQ,EAA1D,GADF;AAEA,MAAMuB,sBAAsB,CAACH,IAAD,EAAOC,QAAP,KAC1BA,SAAS,IAAT,6CAAmBD,IAAnB,IAAyB,EAAEI,MAAM,aAAR,EAAzB,GADF;;QAIEvB,W,GAAAA,W;QACAG,Y,GAAAA,Y;QACAM,e,GAAAA,e;QACAS,c,GAAAA,c;QACAG,oB,GAAAA,oB;QACAC,mB,GAAAA,mB;QACAV,W,GAAAA,W;QACAN,U,GAAAA,U;QACAR,c,GAAAA,c","file":"privileges.js","sourcesContent":["import Promise from 'bluebird';\nimport { getSetting } from './settings';\n\nconst p = Promise.promisify;\n\nconst privileges = require.main.require('./src/privileges');\nconst posts = require.main.require('./src/posts');\nconst privilegesPostCan = p(privileges.posts.can);\nconst privilegesTopicCan = p(privileges.topics.can);\nconst filterUidsByCid = p(privileges.categories.filterUids);\nconst filterPids = p(privileges.posts.filter);\n\nconst privilegeNames = {\n  canPost: 'plugin_calendar:event:post',\n};\n\nconst canViewPost = (pid, uid) => privilegesPostCan('read', pid, uid);\nconst canPostEvent = (tid, uid) => privilegesTopicCan(privilegeNames.canPost, tid, uid);\nconst getCidByPid = p(posts.getCidByPid);\n\nconst canRespond = (pid, uid) =>\n  getSetting('respondIfCanReply')\n    .then((respondIfCanReply) => {\n      if (respondIfCanReply) {\n        return privilegesPostCan('reply', pid, uid);\n      }\n      return canViewPost(pid, uid);\n    });\n\nconst filterUidsByPid = (uids, pid) =>\n  getCidByPid(pid)\n  .then(cid => filterUidsByCid('read', cid, uids));\n\nconst filterByPid = (events, uid) =>\n  filterPids('read', events.map(e => e.pid), uid)\n  .then(filtered => events.filter(e => filtered.includes(e.pid)));\n\nconst privilegesList = (list, callback) =>\n  callback(null, [...list, privilegeNames.canPost]);\nconst privilegesGroupsList = (list, callback) =>\n  callback(null, [...list, `groups:${privilegeNames.canPost}`]);\nconst privilegesListHuman = (list, callback) =>\n  callback(null, [...list, { name: 'Post events' }]);\n\nexport {\n  canViewPost,\n  canPostEvent,\n  filterUidsByPid,\n  privilegesList,\n  privilegesGroupsList,\n  privilegesListHuman,\n  filterByPid,\n  canRespond,\n  privilegeNames,\n};\n"]}