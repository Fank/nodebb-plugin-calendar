{"version":3,"sources":["../../src/client/reminders.js"],"names":["makeListElement","n","zero","li","$","to","data","factory","$ul","addButtons","find","methods","setReminders","reminders","remove","reverse","map","forEach","el","prepend","getReminders","addReminder","nots","includes","sort","a","b","index","indexOf","after","removeReminder","filter","not","popup","input","radios","button","on","e","target","addClass","siblings","removeClass","promptCustom","addNotif","unit","val","number","parseInt","ms","mm","hh","dd","slideUp","off","slideDown","stopPropagation","closest","preventDefault","notif"],"mappings":"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","file":"reminders.js","sourcesContent":["import moment from 'moment';\n\nconst makeListElement = (n) => {\n  const zero = moment(0);\n  const li = $(\n    `<li class=\"plugin-calendar-event-editor-reminder\" data-value=\"${n}\">\n      ${zero.to(n, true)}\n      <a class=\"remove\" href=\"#\">\n        <i class=\"fa fa-times\"></i>\n      </a>\n    </li>`);\n  li.data('value', n);\n  return li;\n};\n\nconst factory = ($ul) => {\n  const addButtons = $ul\n    .find('#plugin-calendar-event-editor-reminders-add li > a');\n\n  const methods = {\n    setReminders: (reminders) => {\n      $ul.find('li.plugin-calendar-event-editor-reminder').remove();\n      $ul.data('value', reminders);\n      reminders\n        .reverse()\n        .map(makeListElement)\n        .forEach(el => $ul.prepend(el));\n    },\n    getReminders: () => $ul.data('value'),\n    addReminder: (n) => {\n      const nots = $ul.data('value');\n      if (nots.includes(n)) {\n        return;\n      }\n\n      const reminders = [...nots, n].sort((a, b) => b - a);\n      const index = reminders.reverse().indexOf(n);\n      $ul.data('value', reminders);\n\n      const li = makeListElement(n);\n\n      if (index === 0) {\n        $ul.prepend(li);\n      } else {\n        $ul.find(`li.plugin-calendar-event-editor-reminder:nth-of-type(${index})`).after(li);\n      }\n    },\n    removeReminder: (n) => {\n      const nots = $ul.data('value');\n      if (!nots.includes(n)) {\n        return;\n      }\n\n      const reminders = nots.filter(not => not !== n);\n      $ul.data('value', reminders);\n\n      $ul.find(`li.plugin-calendar-event-editor-reminder[data-value=${n}]`).remove();\n    },\n  };\n\n  const popup = $('#plugin-calendar-event-editor-reminder-custom');\n  const input = popup.find('#plugin-calendar-event-editor-reminder-custom-number');\n  const radios = popup.find('#plugin-calendar-event-editor-reminder-custom-unit');\n  const button = popup.find('button.btn-primary');\n\n  radios.find('.btn').on('click', (e) => {\n    $(e.target)\n      .addClass('active')\n      .siblings()\n      .removeClass('active');\n  });\n\n  const promptCustom = (addNotif) => {\n    button.on('click', () => {\n      const unit = radios.find(':checked').val();\n      const number = parseInt(input.val(), 10);\n\n      const ms = ({\n        mm: 1000 * 60,\n        hh: 1000 * 60 * 60,\n        dd: 1000 * 60 * 60 * 24,\n      })[unit] * number;\n\n      addNotif(ms);\n      popup.slideUp(200);\n      button.off('click');\n    });\n\n    popup.slideDown(200);\n  };\n\n  popup.on('click', (e) => {\n    e.stopPropagation();\n  });\n\n  addButtons.on('click', (e) => {\n    const el = $(e.target).closest('li');\n    const n = el.data('value');\n\n    if (n === 'custom') {\n      e.preventDefault();\n      e.stopPropagation();\n      promptCustom(notif => methods.addReminder(notif));\n      return;\n    }\n    methods.addReminder(n);\n  });\n\n  $ul.on('click', 'li.plugin-calendar-event-editor-reminder .remove', (e) => {\n    e.preventDefault();\n    const n = $(e.target).closest('li').data('value');\n    methods.removeReminder(n);\n  });\n\n  return methods;\n};\n\nexport default factory;\n"]}