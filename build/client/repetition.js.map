{"version":3,"sources":["../../src/client/repetition.js"],"names":["factory","$ul","list","find","click","e","stopPropagation","custom","$","changeButton","changeButtonText","daysOfWeek","customEnd","endDate","data","format","date","add","widgetPositioning","vertical","horizontal","change","elem","value","val","html","siblings","slideDown","slideUp","preventDefault","target","toggleClass","dropdown","forever","toggle","methods","setRepeat","repeat","prop","key","x","every","removeClass","forEach","day","addClass","Number","isFinite","getRepeat","selected","days","parent","map","parseInt","dataset","end","valueOf"],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,MAAMA,UAAWC,GAAD,IAAS;AACvB,QAAMC,OAAOD,IACVE,IADU,CACL,sDADK,CAAb;AAEAD,OAAKC,IAAL,CAAU,6BAAV,EAAyCC,KAAzC,CAAgDC,CAAD,IAAO;AACpDA,MAAEC,eAAF;AACD,GAFD;;AAIA,QAAMC,SAASC,EAAE,iDAAF,CAAf;AACA,QAAMC,eAAeD,EAAE,wDAAF,CAArB;AACA,QAAME,mBAAmBD,aAAaN,IAAb,CAAkB,OAAlB,CAAzB;AACA,QAAMQ,aAAaH,EAAE,4DAAF,CAAnB;AACA,QAAMI,YAAYL,OAAOJ,IAAP,CAAY,qDAAZ,CAAlB;AACA,QAAMU,UAAUL,EAAE,kDAAF,CAAhB;;AAEAK,UAAQC,IAAR,CAAa,gBAAb,EACGC,MADH,CACU,GADV,EAEGC,IAFH,CAEQ,wBAASC,GAAT,CAAa,CAAb,EAAgB,KAAhB,CAFR,EAGGC,iBAHH,CAGqB;AACjBC,cAAU,KADO;AAEjBC,gBAAY;AAFK,GAHrB;;AAQAlB,OAAKmB,MAAL,CAAY,MAAM;AAChB,UAAMC,OAAOpB,KAAKC,IAAL,CAAU,uCAAV,CAAb;AACA,UAAMoB,QAAQD,KAAKE,GAAL,EAAd;;AAEAd,qBAAiBe,IAAjB,CAAsBH,KAAKI,QAAL,CAAc,MAAd,EAAsBD,IAAtB,EAAtB;;AAEA,QAAIF,UAAU,QAAd,EAAwB;AACtBhB,aAAOoB,SAAP,CAAiB,GAAjB;AACD,KAFD,MAEO;AACLpB,aAAOqB,OAAP,CAAe,GAAf;AACD;AACF,GAXD;;AAaApB,IAAE,0EAAF,EAA8EJ,KAA9E,CAAqFC,CAAD,IAAO;AACzFA,MAAEwB,cAAF;AACArB,MAAEH,EAAEyB,MAAJ,EAAYC,WAAZ,CAAwB,QAAxB;AACD,GAHD;;AAKAxB,SAAOJ,IAAP,CAAY,kBAAZ,EAAgCC,KAAhC,CAAsC,MAAM;AAC1CK,iBAAauB,QAAb,CAAsB,QAAtB;AACD,GAFD;;AAIApB,YAAUS,MAAV,CAAiB,MAAM;AACrB,UAAMY,UAAUrB,UACbT,IADa,CACR,+BADQ,EAEbqB,GAFa,OAEH,SAFb;AAGAX,YAAQqB,MAAR,CAAe,CAACD,OAAhB;AACD,GALD;;AAOA,QAAME,UAAU;AACdC,eAAYC,MAAD,IAAY;AACrB,UAAI,CAACA,MAAL,EAAa;AACX,cAAMf,OAAOpB,KACVC,IADU,CACL,+CADK,EAEVmC,IAFU,CAEL,SAFK,EAEM,IAFN,CAAb;AAGA5B,yBAAiBe,IAAjB,CAAsBH,KAAKI,QAAL,CAAc,MAAd,EAAsBD,IAAtB,EAAtB;AACA;AACD;;AAED,YAAMc,MAAM,CAAC,KAAD,EAAQ,MAAR,EAAgB,OAAhB,EAAyB,MAAzB,EACTpC,IADS,CACJqC,KAAKH,OAAOI,KAAP,CAAaD,CAAb,CADD,CAAZ;AAEAjC,aAAO2B,MAAP,CAAc,CAACK,GAAf;AACA,UAAIA,GAAJ,EAAS;AACP,cAAMjB,OAAOpB,KACVC,IADU,CACJ,qCAAoCoC,GAAI,IADpC,EAEVD,IAFU,CAEL,SAFK,EAEM,IAFN,CAAb;AAGA5B,yBAAiBe,IAAjB,CAAsBH,KAAKI,QAAL,CAAc,MAAd,EAAsBD,IAAtB,EAAtB;AACA;AACD;;AAED,YAAMH,OAAOpB,KACVC,IADU,CACL,4CADK,EAEVmC,IAFU,CAEL,SAFK,EAEM,IAFN,CAAb;AAGA5B,uBAAiBe,IAAjB,CAAsBH,KAAKI,QAAL,CAAc,MAAd,EAAsBD,IAAtB,EAAtB;;AAEA,UAAIY,OAAOI,KAAP,CAAa9B,UAAjB,EAA6B;AAC3BA,mBACGR,IADH,CACQ,QADR,EAEGuC,WAFH,CAEe,QAFf;AAGAL,eAAOI,KAAP,CAAa9B,UAAb,CAAwBgC,OAAxB,CAAiCC,GAAD,IAAS;AACvCjC,qBACGR,IADH,CACS,iBAAgByC,GAAI,OAD7B,EAEGC,QAFH,CAEY,QAFZ;AAGD,SAJD;AAKA,cAAMZ,UAAU,CAACa,OAAOC,QAAP,CAAgBV,OAAOxB,OAAvB,CAAjB;AACAD,kBACGT,IADH,CACS,+BAA8B8B,UAAU,SAAV,GAAsB,KAAM,GADnE,EAEGK,IAFH,CAEQ,SAFR,EAEmB,IAFnB;AAGAzB,gBAAQqB,MAAR,CAAe,CAACD,OAAhB;AACA,YAAI,CAACA,OAAL,EAAc;AACZpB,kBAAQC,IAAR,CAAa,gBAAb,EAA+BE,IAA/B,CAAoC,sBAAOqB,OAAOxB,OAAd,CAApC;AACD;AACF;AACF,KA5Ca;AA6CdmC,eAAW,MAAM;AACf,YAAMzB,QAAQrB,KAAKC,IAAL,CAAU,kCAAV,EAA8CqB,GAA9C,EAAd;AACA,UAAID,UAAU,WAAd,EAA2B;AACzB,eAAO,IAAP;AACD;AACD,UAAIA,UAAU,QAAd,EAAwB;AACtB,eAAO;AACLkB,iBAAO;AACL,aAAClB,KAAD,GAAS;AADJ,WADF;AAILV,mBAAS;AAJJ,SAAP;AAMD;;AAED,YAAMoC,WAAW,QAAjB;AACA,UAAIA,aAAa,QAAjB,EAA2B;AACzB,cAAMC,OAAO,2CAAIvC,WAAWR,IAAX,CAAgB,eAAhB,EAAiCgD,MAAjC,EAAJ,GACVC,GADU,CACN9B,QAAQ+B,SAAS/B,KAAKgC,OAAL,CAAa/B,KAAtB,EAA6B,EAA7B,CADF,CAAb;AAEA,cAAMU,UAAUrB,UACbT,IADa,CACR,+BADQ,EAEbqB,GAFa,OAEH,SAFb;AAGA,YAAIS,OAAJ,EAAa;AACX,iBAAO;AACLQ,mBAAO;AACL9B,0BAAYuC;AADP,aADF;AAILrC,qBAAS;AAJJ,WAAP;AAMD;AACD,cAAM0C,MAAM1C,QACTC,IADS,CACJ,gBADI,EAETE,IAFS,GAGTwC,OAHS,EAAZ;AAIA,eAAO;AACLf,iBAAO;AACL9B,wBAAYuC;AADP,WADF;AAILrC,mBAAS0C;AAJJ,SAAP;AAMD;;AAED,aAAO,EAAP;AACD;AAvFa,GAAhB;;AA0FA,SAAOpB,OAAP;AACD,CA9ID;;kBAgJenC,O","file":"repetition.js","sourcesContent":["import moment from 'moment';\n\nconst factory = ($ul) => {\n  const list = $ul\n    .find('#plugin-calendar-event-editor-repetition-change > ul');\n  list.find('li[data-value=custom] > div').click((e) => {\n    e.stopPropagation();\n  });\n\n  const custom = $('#plugin-calendar-event-editor-repetition-custom');\n  const changeButton = $('#plugin-calendar-event-editor-repetition-change-button');\n  const changeButtonText = changeButton.find('.text');\n  const daysOfWeek = $('#plugin-calendar-event-editor-repetition-custom-daysOfWeek');\n  const customEnd = custom.find('.plugin-calendar-event-editor-repetition-custom-end');\n  const endDate = $('#plugin-calendar-event-editor-repetition-endDate');\n\n  endDate.data('DateTimePicker')\n    .format('L')\n    .date(moment().add(7, 'day'))\n    .widgetPositioning({\n      vertical: 'top',\n      horizontal: 'left',\n    });\n\n  list.change(() => {\n    const elem = list.find('input[name=repetition-select]:checked');\n    const value = elem.val();\n\n    changeButtonText.html(elem.siblings('span').html());\n\n    if (value === 'custom') {\n      custom.slideDown(200);\n    } else {\n      custom.slideUp(200);\n    }\n  });\n\n  $('#plugin-calendar-event-editor-repetition-custom-daysOfWeek > ul > li > a').click((e) => {\n    e.preventDefault();\n    $(e.target).toggleClass('active');\n  });\n\n  custom.find('.btn.btn-primary').click(() => {\n    changeButton.dropdown('toggle');\n  });\n\n  customEnd.change(() => {\n    const forever = customEnd\n      .find('[name=repetition-end]:checked')\n      .val() === 'forever';\n    endDate.toggle(!forever);\n  });\n\n  const methods = {\n    setRepeat: (repeat) => {\n      if (!repeat) {\n        const elem = list\n          .find('[name=\"repetition-select\"][value=\"no-repeat\"]')\n          .prop('checked', true);\n        changeButtonText.html(elem.siblings('span').html());\n        return;\n      }\n\n      const key = ['day', 'week', 'month', 'year']\n        .find(x => repeat.every[x]);\n      custom.toggle(!key);\n      if (key) {\n        const elem = list\n          .find(`[name=\"repetition-select\"][value=\"${key}\"]`)\n          .prop('checked', true);\n        changeButtonText.html(elem.siblings('span').html());\n        return;\n      }\n\n      const elem = list\n        .find('[name=\"repetition-select\"][value=\"custom\"]')\n        .prop('checked', true);\n      changeButtonText.html(elem.siblings('span').html());\n\n      if (repeat.every.daysOfWeek) {\n        daysOfWeek\n          .find('li > a')\n          .removeClass('active');\n        repeat.every.daysOfWeek.forEach((day) => {\n          daysOfWeek\n            .find(`li[data-value=${day}] > a`)\n            .addClass('active');\n        });\n        const forever = !Number.isFinite(repeat.endDate);\n        customEnd\n          .find(`[name=repetition-end][value=${forever ? 'forever' : 'end'}]`)\n          .prop('checked', true);\n        endDate.toggle(!forever);\n        if (!forever) {\n          endDate.data('DateTimePicker').date(moment(repeat.endDate));\n        }\n      }\n    },\n    getRepeat: () => {\n      const value = list.find('[name=repetition-select]:checked').val();\n      if (value === 'no-repeat') {\n        return null;\n      }\n      if (value !== 'custom') {\n        return {\n          every: {\n            [value]: true,\n          },\n          endDate: null,\n        };\n      }\n\n      const selected = 'weekly';\n      if (selected === 'weekly') {\n        const days = [...daysOfWeek.find('li > a.active').parent()]\n          .map(elem => parseInt(elem.dataset.value, 10));\n        const forever = customEnd\n          .find('[name=repetition-end]:checked')\n          .val() === 'forever';\n        if (forever) {\n          return {\n            every: {\n              daysOfWeek: days,\n            },\n            endDate: null,\n          };\n        }\n        const end = endDate\n          .data('DateTimePicker')\n          .date()\n          .valueOf();\n        return {\n          every: {\n            daysOfWeek: days,\n          },\n          endDate: end,\n        };\n      }\n\n      return {};\n    },\n  };\n\n  return methods;\n};\n\nexport default factory;\n"]}